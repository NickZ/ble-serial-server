name: roshub-ble-serial-server
version: 0.1
summary: ble device service
description: ble device service
icon: icons/roshub_vector_logo-256x256.png
base: core18
confinement: strict
grade: stable

architectures:
  - build-on: amd64
    run-on: amd64

  - build-on: i386
    run-on: i386

  - build-on: armhf
    run-on: armhf

  - build-on: arm64
    run-on: arm64

apps:
  ble-serial-server:
    command: bleSerialServer

parts:
  qt:
    plugin: qtbuilder
    qt-version: 5.9.1
    qt-source-git: https://code.qt.io/qt/qt5.git
    qt-submodules: ['qtbase']
    environment:
      - CC: gcc-7
      - CXX: g++-7
      - QMAKE_CC: gcc-7
      - QMAKE_CXX: g++-7
    build-packages:
      - qtbase5-dev
      - qtconnectivity5-dev
    stage-packages:
      # Here for the plugins-- they're not linked in automatically.
      - libqt5core5
      - libqt5bluetooth5
    configflags:
      - -prefix
      - $SNAPCRAFT_STAGE
      - -release
      - -static
    after:
      - gcc7
    prime: [-./*]

  gcc7:
    plugin: nil
    build-packages:
      - libmpc-dev
      - libcloog-ppl-dev
    override-pull: |
      echo "deb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu xenial main" | \
            sudo tee /etc/apt/sources.list.d/ubuntu-toolchain-r.list
      sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 60C317803A41BA51845E371A1E9377A2BA9EF27F
      sudo apt-get update \
        -o Dir::Etc::sourcelist="sources.list.d/ubuntu-toolchain-r.list" \
        -o Dir::Etc::sourceparts="-" -o APT::Get::List-Cleanup="0"
      snapcraftctl pull
    override-build: |
      sudo apt install gcc-7 g++-7 -o Debug::pkgProblemResolver=yes --no-install-recommends -y
      sudo apt-mark auto gcc-7 g++-7
      sudo rm -f /etc/apt/sources.list.d/ubuntu-toolchain-r.list
      snapcraftctl build
    prime: [-./*]
